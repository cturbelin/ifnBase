---
title: "Platform definition File"
author: "ClÃ©ment Turbelin"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Platform definition File}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Platform file

Platform file describe characteristics of a given InfluenzaNet platform :

- Define some options for the platform (default language for example)
- describe available surveys (structure & coding) and mapping to DB tables
- describe geographic levels & mapping to DB tables 

It is just a R script with a list of variables or function calls.

This file has to be stored in a directory (which can contains several platform definitions) and location is defined with `platform.path` package options (see *introduction* vignette).
The name of this file define the platform id (code of the country for example).

# Contents

## Global options : to be defined with `platform_options()` function in the platform file

### `survey_default_language`
Define the code of the language to use by default in i18n files.

### `survey_use_channel` 
boolean. If TRUE by default survey response will be loaded only for empty channel. If FALSE, channel column will be ignored.

### `first.season.censored` (optional)
boolean value. if TRUE the first season of each particpant need to be left censored (we dont have data before)

### `get_first_season_country` function(country)
function with one parameter `country`. Should return the first available season year for the country. This is needed when `first.season.censored` is active (TRUE) to
 
### `health.status` (optional)
If the data storage model is using a single table for each survey, you have to describe the table (or view) containing
health status computed from each weekly survey 

```{r eval=FALSE}
list(
 default="health_status_view" # Table name containing health status for each survey
 id="weekly_id" # Name of the column containg the corresponding response id in the weekly's data response table. 
)
```

### `complete.intake`
list() of parameters to be used to define the intake completion strategy

## Example

```{r eval=FALSE}
platform_options(
  first.season.censored=FALSE
)

```
## Survey registration

Each survey has to be registred to the package before the surveys_* functions can be used. 
Registration is done by calling the function `platform_define_survey()` (usually in the platform file to be available in all the scripts, but it's possible to register a new survey in a script).

This registration will assign a unique internal name to the survey that all the `survey_*` will recognise in the *survey* parameter. You can give the name you want to your surveys (by convention we use "intake" and "weekly" for respectively)


For example for a short survey about vaccination

```{r eval=FALSE}

platform_define_survey(
  name="mysurvey"
  survey_id = 12,
  mapping= list(
    'age'='Q1'  # Q1 = Name in the DB -> 'age' name in the R data
    'vaccination'='Q2',
    'vacc.at_risk'='Q3_1',
    'vacc.health_prof'='Q3_2'
    'vacc.work'='Q3_3'
    ),
  recoding=list(
    'vaccination'=c('yes'='1','no'='2', 'unknown'='3') # Describe recoding to meaningfull levels
  ),
  labels = list(
    'vacc.reason'='vacc.*' # Define a pattern to identify all variables about vaccination reason
  )
)

```




## Survey History

- platform_season_history(season, dates, ...): describes dates of a season & optionnally table name for each season (multiple table model)

## Geographic tables

`platform_geographic_levels` describes available geographic levels and how they are organized (hierarchies)

`platform_geographic_tables` allows to describe for each level the table describing area and the columns mapping.
